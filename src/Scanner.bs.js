// Generated by BUCKLESCRIPT VERSION 5.0.2, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("bs-platform/lib/js/curry.js");
var Caml_option = require("bs-platform/lib/js/caml_option.js");
var JsQr$QueerLoop = require("./JsQr.bs.js");
var UserMedia$QueerLoop = require("./UserMedia.bs.js");

function scanUsingDeviceId(videoEl, deviceId, scanCallback) {
  return UserMedia$QueerLoop.initStreamByDeviceId(videoEl, deviceId).then((function (video) {
                var canvas = document.createElement("canvas");
                var onTick = function (param) {
                  if (video.readyState === 4) {
                    var width = video.videoWidth;
                    var height = video.videoHeight;
                    canvas.width = width;
                    canvas.height = height;
                    var ctx = canvas.getContext("2d");
                    ctx.drawImage(video, 0, 0);
                    var imageData = ctx.getImageData(0, 0, width, height);
                    var maybeCode = JsQr$QueerLoop.jsQR(imageData.data, width, height);
                    if (maybeCode !== undefined) {
                      Curry._1(scanCallback, Caml_option.valFromOption(maybeCode).data);
                    }
                    
                  }
                  requestAnimationFrame(onTick);
                  return /* () */0;
                };
                requestAnimationFrame(onTick);
                return Promise.resolve(/* () */0);
              }));
}

exports.scanUsingDeviceId = scanUsingDeviceId;
/* JsQr-QueerLoop Not a pure module */
